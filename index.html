<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bracket Interactivo - Torneo Educación Financiera (con feedback)</title>
<style>
  :root{
    --bg:#061221; --card:#0b2030;
    --accent-blue:#1e90ff; --accent-green:#2dd4bf;
    --muted:#9aa9b2; --glass: rgba(255,255,255,0.03);
    --toast-correct: #1f7a2f;
    --toast-wrong: #9b2b2b;
    --toast-skip: #555b66;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:linear-gradient(180deg,#041322,#02121a);color:#eaf6f8}
  .container{max-width:1200px;margin:22px auto;padding:18px}
  .header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
  h1{margin:0;font-size:20px}
  .muted{color:var(--muted);font-size:13px}
  .btn{background:linear-gradient(90deg,var(--accent-blue),var(--accent-green));color:#021014;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .bracket{display:grid;grid-template-columns:260px 1fr 260px;gap:18px;align-items:start}
  .col{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
  .round-title{font-weight:700;margin-bottom:10px;color:var(--muted);font-size:13px}
  .match{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:10px;border-radius:10px;margin-bottom:16px;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
  .teams{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .team-row{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.01)}
  .team-name{font-weight:700}
  .team-score{font-size:13px;color:var(--muted)}
  .winner{box-shadow:0 6px 14px rgba(46,204,113,0.06);border-left:4px solid var(--accent-green)}
  .center-col{display:flex;flex-direction:column;gap:22px;align-items:center;padding-top:20px}
  .final-box{padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
  /* modal quiz */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,8,15,0.6);display:none;align-items:center;justify-content:center;z-index:1000}
  .modal{background:linear-gradient(180deg,#071927,#041726);width:96%;max-width:980px;max-height:90vh;overflow:auto;border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.04)}
  .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .close{background:transparent;border:0;color:var(--muted);font-size:22px;cursor:pointer}
  .quiz-body{padding:8px}
  .qbox{padding:12px;border-radius:8px;background:rgba(255,255,255,0.015);margin-bottom:8px}
  .options{display:flex;flex-direction:column;gap:10px;margin-top:8px}
  label.option{display:flex;gap:12px;align-items:center;cursor:pointer}
  input[type="radio"]{accent-color:var(--accent-blue)}
  .controls{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:10px}
  .timer{font-weight:800;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:14px}
  .small{font-size:13px;color:var(--muted)}
  /* Toast (feedback) just below question */
  .toast-wrap{display:flex;justify-content:center;margin-top:6px;min-height:28px}
  .toast{
    padding:8px 12px;border-radius:8px;color:#fff;font-weight:700;font-size:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.5);opacity:0;transform:translateY(8px);transition:opacity .25s,transform .25s;
  }
  .toast.show{opacity:1;transform:translateY(0);}
  @media (max-width:980px){.bracket{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <h1>Bracket Interactivo — Torneo Educación Financiera</h1>
      <div class="muted">Formato: 6 preguntas por equipo / 12 por llave · 30s por pregunta · feedback visible debajo de la pregunta.</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="muted small">Ponderación: Principiante=1 · Intermedio=2 · Avanzado=3</div>
      <button id="resetBtn" class="btn">Resetear Bracket</button>
    </div>
  </div>

  <div class="bracket" id="bracketRoot">
    <div class="col">
      <div class="round-title">Cuartos de Final</div>

      <div class="match" data-match="q1" id="match-q1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Llave 1 — Los Cotiquinos vs Financiados y Asociados</strong><span class="small">Tema: Presupuestos</span>
        </div>
        <div class="teams">
          <div class="team-row" data-team="Los Cotiquinos"><div class="team-name">Los Cotiquinos</div><div class="team-score" id="score-q1-A">—</div></div>
          <div class="team-row" data-team="Financiados y Asociados"><div class="team-name">Financiados y Asociados</div><div class="team-score" id="score-q1-B">—</div></div>
        </div>
      </div>

      <div class="match" data-match="q2" id="match-q2">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Llave 2 — Los Tarara vs Money Squad</strong><span class="small">Tema: Crédito</span>
        </div>
        <div class="teams">
          <div class="team-row" data-team="Los Tarara"><div class="team-name">Los Tarara</div><div class="team-score" id="score-q2-C">—</div></div>
          <div class="team-row" data-team="Money Squad"><div class="team-name">Money Squad</div><div class="team-score" id="score-q2-D">—</div></div>
        </div>
      </div>

      <div class="match" data-match="q3" id="match-q3">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Llave 3 — CashCrew vs Capitalizados</strong><span class="small">Tema: Ahorro</span>
        </div>
        <div class="teams">
          <div class="team-row" data-team="CashCrew"><div class="team-name">CashCrew</div><div class="team-score" id="score-q3-E">—</div></div>
          <div class="team-row" data-team="Capitalizados"><div class="team-name">Capitalizados</div><div class="team-score" id="score-q3-F">—</div></div>
        </div>
      </div>

      <div class="match" data-match="q4" id="match-q4">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Llave 4 — Capital Go Three vs Dayro Moreno</strong><span class="small">Tema: Inversión</span>
        </div>
        <div class="teams">
          <div class="team-row" data-team="Capital Go Three"><div class="team-name">Capital Go Three</div><div class="team-score" id="score-q4-G">—</div></div>
          <div class="team-row" data-team="Dayro Moreno"><div class="team-name">Dayro Moreno</div><div class="team-score" id="score-q4-H">—</div></div>
        </div>
      </div>
    </div>

    <div class="center-col">
      <div class="round-title">Semifinales (doble clic para abrir quiz)</div>

      <div class="center-match" id="match-sf1">
        <div class="final-box match" data-match="sf1" id="match-sf1-box">
          <strong>SF1 — Ganador Q1 vs Ganador Q2</strong>
          <div class="teams" style="margin-top:8px">
            <div class="team-row" id="sf1-team1"><div class="team-name">—</div><div class="team-score" id="score-sf1-1">—</div></div>
            <div class="team-row" id="sf1-team2"><div class="team-name">—</div><div class="team-score" id="score-sf1-2">—</div></div>
          </div>
        </div>
      </div>

      <div class="center-match" id="match-sf2">
        <div class="final-box match" data-match="sf2" id="match-sf2-box">
          <strong>SF2 — Ganador Q3 vs Ganador Q4</strong>
          <div class="teams" style="margin-top:8px">
            <div class="team-row" id="sf2-team1"><div class="team-name">—</div><div class="team-score" id="score-sf2-1">—</div></div>
            <div class="team-row" id="sf2-team2"><div class="team-name">—</div><div class="team-score" id="score-sf2-2">—</div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="round-title">Final</div>
      <div class="final-box match" data-match="f" id="match-f">
        <strong>Final — Ganador SF1 vs Ganador SF2</strong>
        <div class="teams" style="margin-top:8px">
          <div class="team-row" id="f-team1"><div class="team-name">—</div><div class="team-score" id="score-f-1">—</div></div>
          <div class="team-row" id="f-team2"><div class="team-name">—</div><div class="team-score" id="score-f-2">—</div></div>
        </div>
      </div>
      <div style="height:14px"></div>
      <div class="muted small" style="margin-top:10px">Instrucciones: haz clic (o doble clic en semis/final) para iniciar. 30s por pregunta. Feedback justo debajo de la pregunta.</div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div><strong id="modalTitle">Llave</strong><div id="modalSubtitle" class="small muted"></div></div>
      <div><button class="close" id="closeModal">&times;</button></div>
    </div>

    <div class="quiz-body" id="quizContainer">
      <!-- Pregunta única y opciones aparecenderán aquí -->
    </div>

    <!-- TOAST area: justo debajo de la pregunta (Opción 5) -->
    <div class="toast-wrap"><div id="toast" class="toast" aria-live="polite"></div></div>

    <div class="controls" style="padding:10px;">
      <div style="display:flex;gap:12px;align-items:center">
        <div id="progressText" class="small">Pregunta 1/12</div>
        <div id="teamText" class="small">Equipo: —</div>
        <div id="numText" class="small">N° para equipo: —</div>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <div class="timer" id="timerDisplay">30s</div>
        <button id="skipBtn" class="btn" style="background:rgba(255,255,255,0.06);color:#eaf6f8">Saltar pregunta</button>
        <button id="nextBtn" class="btn" style="display:none">Siguiente</button>
        <button id="submitQuiz" class="btn" style="display:none;background:linear-gradient(90deg,var(--accent-green),var(--accent-blue));">Calcular ganador</button>
      </div>
    </div>
  </div>
</div>

<script>
/*
  Fuente del banco de preguntas (archivo subido): /mnt/data/Preguntas educacion financiera.docx
  (Ruta local usada como referencia). :contentReference[oaicite:1]{index=1}
*/

/* Ponderaciones */
const WEIGHTS = { 'Principiante':1, 'Intermedio':2, 'Avanzado':3 };

/* Helper para preguntas */
function makeQ(text,a,b,c,d,correct,level){ return { text, options:{a,b,c,d}, correct, level }; }

/* 84 preguntas (idénticas a las del documento) */
const questionsAll = [
/* 1 */ makeQ('¿Cuál es el propósito esencial de un fondo de emergencia?','Cubrir gastos imprevistos que afecten tu estabilidad financiera.','Acumular capital para futuras inversiones rentables.','Mantener liquidez para aprovechar oportunidades de negocio.','Guardar dinero para gastos planificados de mediano plazo.','a','Principiante'),
/* 2 */ makeQ('El APR (Tasa Porcentual Anual) en un crédito refleja:','Únicamente la tasa de interés nominal del préstamo.','El costo total anualizado incluyendo intereses y cargos adicionales.','El monto total que debes devolver al finalizar el plazo.','El porcentaje de tu ingreso comprometido en el pago.','b','Principiante'),
/* 3 */ makeQ('Según la regla 50/30/20 para presupuesto personal, ¿qué porcentaje se destina a ahorro o pago de deudas?','30% para metas financieras y reducción de pasivos.','10% como mínimo recomendado para el ahorro.','20% para construir patrimonio y saldar obligaciones.','50% dividido entre ahorro e inversión.','c','Principiante'),
/* 4 */ makeQ('La diferencia principal entre interés simple y compuesto es que:','El interés simple se calcula solo sobre el capital inicial.','El interés simple siempre produce mayores ganancias a largo plazo.','El interés compuesto solo se aplica en préstamos hipotecarios.','El interés compuesto genera rendimientos sobre intereses acumulados.','d','Principiante'),
/* 5 */ makeQ('Para evitar un sobregiro en tu cuenta bancaria, es recomendable:','Monitorear regularmente tu saldo y configurar alertas.','Mantener siempre el saldo mínimo requerido por la entidad.','Solicitar una línea de crédito de respaldo automática.','Realizar retiros solo en cajeros de tu banco principal.','a','Principiante'),
/* 6 */ makeQ('El objetivo principal de la educación financiera es que las personas:','Dominen fórmulas matemáticas complejas de finanzas avanzadas.','Gestionen sus recursos económicos con criterio y responsabilidad.','Multipliquen sus ingresos en el menor tiempo posible.','Eviten completamente el uso de servicios bancarios.','b','Principiante'),
/* 7 */ makeQ('Gastos como alimentación, vivienda y transporte se clasifican como:','Gastos discrecionales que pueden eliminarse fácilmente.','Inversiones en capital humano de largo plazo.','Necesidades básicas esenciales para la vida diaria.','Gastos variables que dependen del estilo de vida.','c','Principiante'),
/* 8 */ makeQ('Invertir consiste fundamentalmente en:','Guardar dinero en efectivo sin generar movimientos.','Adquirir bienes de consumo que mejoren tu calidad de vida.','Utilizar todo el dinero disponible para cancelar deudas.','Destinar recursos con expectativa de obtener ganancias futuras.','d','Principiante'),
/* 9 */ makeQ('Antes de elegir un producto financiero, es fundamental preguntarse:','Cuál es la rentabilidad o costo que ofrece el producto.','Cuántos años tiene la institución en el mercado.','Qué opinan otras personas sobre esta entidad.','Quiénes son los directivos de la empresa financiera.','a','Principiante'),
/*10*/ makeQ('Al comprar un producto a crédito en comparación con comprarlo de contado:','El costo total suele ser menor debido a promociones especiales.','Generalmente terminas pagando un monto superior al precio original.','Obtienes beneficios adicionales como garantías extendidas.','Pagas exactamente el mismo valor en ambas modalidades.','b','Principiante'),
/*11*/ makeQ('Un factor crítico al decidir dónde ahorrar tu dinero es:','La ubicación geográfica de las sucursales bancarias.','Los colores y diseño de la imagen corporativa.','El nivel de seguridad y respaldo que ofrece la institución.','La antigüedad de la empresa en el sector.','c','Principiante'),
/*12*/ makeQ('La capacidad que tiene una persona para cumplir con sus obligaciones financieras se denomina:','Liquidez disponible para operaciones corrientes.','Nivel de endeudamiento aceptable.','Patrimonio neto acumulado.','Solvencia o capacidad de pago.','d','Principiante'),
/*13*/ makeQ('Si deseas solicitar una hipoteca y actualmente tienes deudas de consumo, lo más recomendable es:','Reducir o eliminar esas deudas antes de aplicar.','Consolidar todas las deudas en un solo préstamo personal.','No mencionar estas obligaciones en la solicitud hipotecaria.','Aumentar el plazo de pago de las deudas existentes.','a','Principiante'),
/*14*/ makeQ('Una tarjeta de crédito te permite:','Acceder únicamente al dinero que tienes depositado.','Realizar compras utilizando un cupo de crédito prestado.','Identificarte como cliente preferencial del banco.','Evitar completamente el pago de comisiones bancarias.','b','Principiante'),
/*15*/ makeQ('Una ventaja significativa del crédito es:','Reducir tus ingresos disponibles mensualmente.','Endeudarte sin límites ni restricciones.','Poder comprar inmediatamente sin disponer del monto total.','Eliminar la necesidad de ahorrar para el futuro.','c','Principiante'),
/*16*/ makeQ('Financiar educación superior, vivienda propia o un negocio productivo se considera:','Deuda innecesaria que debe evitarse.','Deuda informal de alto riesgo.','Deuda mala que no genera valor.','Deuda buena con potencial de generar valor futuro.','d','Principiante'),
/*17*/ makeQ('Una recomendación prudente al momento de invertir es:','Basarse en principios sólidos y estrategias conservadoras.','Seguir las tendencias populares y la publicidad masiva.','Elegir productos al azar para diversificar rápidamente.','Apostar en instrumentos de alta volatilidad exclusivamente.','a','Principiante'),
/*18*/ makeQ('Para evaluar correctamente un préstamo es esencial revisar:','El número de cajeros automáticos disponibles.','Todos los costos asociados incluyendo cargos ocultos.','La modernidad y diseño de las oficinas.','La cantidad de productos que ofrece la entidad.','b','Principiante'),
/*19*/ makeQ('Si tu presupuesto proyectado no coincide con los gastos reales, esto indica que:','Debes suspender temporalmente tu plan de ahorro.','Ya no es necesario hacer presupuestos futuros.','Debes ajustar y mejorar tus estimaciones.','Necesitas solicitar un préstamo para cubrir la diferencia.','c','Principiante'),
/*20*/ makeQ('Elaborar un presupuesto personal consiste principalmente en:','Calcular únicamente los impuestos a pagar.','Analizar el rendimiento de tus inversiones en bolsa.','Abrir certificados de depósito a término fijo.','Detallar y proyectar tus ingresos y gastos esperados.','d','Principiante'),
/*21*/ makeQ('El ahorro personal se define como:','La diferencia entre tus ingresos y tu consumo.','La diferencia entre tus activos totales y pasivos totales.','La suma de todas tus inversiones acumuladas.','El enganche pagado menos la deuda hipotecaria pendiente.','a','Principiante'),
/*22*/ makeQ('Al elegir una institución para depositar tus ahorros, lo más importante es:','Las promociones y regalos que ofrecen actualmente.','El nivel de seguridad y regulación de la entidad.','El tipo de arquitectura de sus edificios.','Las condiciones climáticas de la ciudad donde opera.','b','Principiante'),
/*23*/ makeQ('Al comparar opciones de crédito, lo fundamental es analizar:','El prestigio histórico de la marca bancaria.','La apariencia física de las instalaciones.','Condiciones específicas: tasas, comisiones y plazos.','Los colores corporativos de la institución.','c','Principiante'),
/*24*/ makeQ('El tiempo transcurrido entre recibir un préstamo y realizar el primer pago se denomina:','Plan de amortización inicial.','Tasa de interés preferencial.','Comisión por apertura del crédito.','Periodo de gracia o diferimiento de pagos.','d','Principiante'),
/*25*/ makeQ('Una ventaja de usar servicios formales de remesas internacionales es:','Ofrecen seguridad respaldada por supervisión regulatoria.','Nunca cobran comisiones por las transacciones.','No requieren ningún tipo de identificación personal.','No tienen límites en los montos a enviar.','a','Principiante'),
/*26*/ makeQ('Una ventaja práctica de utilizar cajeros automáticos es:','Otorgan préstamos automáticos sin evaluación previa.','Reducen el tiempo de espera en filas de sucursales.','Operan exclusivamente durante horarios nocturnos.','No requieren el uso de tarjetas bancarias.','b','Principiante'),
/*27*/ makeQ('En educación financiera, la gestión adecuada del dinero implica:','Utilizar crédito para financiar todos los gastos.','Ignorar los gastos pequeños y frecuentes.','Organizar ingresos y gastos de forma sistemática.','Ahorrar únicamente cuando sobra dinero al final del mes.','c','Principiante'),
/*28*/ makeQ('El periodo sin obligación de pago inmediatamente después de recibir un préstamo se conoce como:','Comisión por apertura del crédito.','Penalidad por pago anticipado.','Retención provisional de fondos.','Periodo de gracia o diferimiento.','d','Principiante'),

/* 29..56 Intermedio */
 /*29*/ makeQ('El propósito fundamental de la educación financiera es:','Proporcionar herramientas para administrar el dinero eficazmente.','Identificar cuál es el mejor banco del país.','Facilitar el acceso a créditos complejos.','Enseñar exclusivamente sobre inversión en bolsa de valores.','a','Intermedio'),
 /*30*/ makeQ('Vivir sin objetivos financieros claros se puede comparar con:','Conducir un automóvil sin combustible en el tanque.','Navegar en internet sin conexión estable.','Habitar en una casa recién construida sin amueblar.','Leer un libro sin páginas numeradas.','b','Intermedio'),
 /*31*/ makeQ('La deuda de tarjetas de crédito frecuentemente se clasifica como "deuda mala" porque:','Está respaldada por bienes inmuebles de alto valor.','Siempre es deducible de impuestos en la declaración anual.','Tiene tasas elevadas y no genera beneficios futuros.','Sus tasas de interés son muy bajas comparadas con otros créditos.','c','Intermedio'),
 /*32*/ makeQ('Antes de abrir una cuenta de ahorros es prudente:','Depositar grandes cantidades sin verificar las condiciones.','Aceptar la primera oferta sin leer detenidamente.','Abrir múltiples cuentas simultáneamente en varios bancos.','Revisar condiciones y hacer preguntas específicas.','d','Intermedio'),
 /*33*/ makeQ('El periodo de gracia en un préstamo se refiere a:','El tiempo entre recibir el dinero y el primer pago.','La fecha límite de vencimiento del crédito.','El plazo máximo de mora sin penalizaciones.','Un descuento especial en los intereses pactados.','a','Intermedio'),
 /*34*/ makeQ('La construcción de riqueza a largo plazo requiere aprender sobre:','Exclusivamente la planificación tributaria y fiscal.','Diversificación, interés compuesto y gestión de activos.','Únicamente los diferentes tipos de deudas disponibles.','Solo créditos de alto riesgo y alta rentabilidad.','b','Intermedio'),
 /*35*/ makeQ('Para desarrollar hábitos financieros saludables y sostenibles se recomienda:','Depender completamente de asesores financieros externos.','Evitar totalmente cualquier tipo de deuda.','Estudiar y actualizar conocimientos regularmente.','Leer únicamente noticias económicas diarias.','c','Intermedio'),
 /*36*/ makeQ('Ingresos como comisiones, bonos, premios o subsidios se clasifican como:','Ingresos fijos garantizados mensualmente.','Ingresos pasivos generados automáticamente.','Ingresos no contables para efectos fiscales.','Ingresos variables sin periodicidad garantizada.','d','Intermedio'),
 /*37*/ makeQ('Invertir en títulos valores o certificados de depósito implica tener:','Instrumentos de renta fija y, potencialmente, variable.','Únicamente instrumentos de renta variable.','Exclusivamente bienes tangibles y físicos.','Dinero guardado en efectivo disponible.','a','Intermedio'),
 /*38*/ makeQ('La matemática financiera se enfoca principalmente en:','Calcular activos y pasivos legales corporativos.','Trasladar capitales y montos en el tiempo.','Determinar impuestos y deducciones fiscales.','Gestionar tasas bancarias y comisiones administrativas.','b','Intermedio'),
 /*39*/ makeQ('Un nivel prudente de "deuda mala" en tus finanzas personales debería ser:','Aproximadamente el 10% de tu ingreso anual total.','Variable según las políticas del banco que uses.','Prácticamente inexistente o muy reducido.','Superior a la mitad de tus ingresos mensuales.','c','Intermedio'),
 /*40*/ makeQ('En el contexto de un préstamo, los "cargos" representan:','La tasa de interés final acordada en el contrato.','El monto total de cada cuota mensual de pago.','La garantía o colateral requerido por el banco.','Costos administrativos cobrados una sola vez.','d','Intermedio'),
 /*41*/ makeQ('Un fondo de inversión se define como:','Un patrimonio común administrado profesionalmente.','Un crédito colectivo otorgado entre instituciones bancarias.','Un préstamo sin intereses para inversionistas nuevos.','Una cuenta de ahorros que nunca genera rendimientos.','a','Intermedio'),
 /*42*/ makeQ('Cuando tus ingresos superan a tus gastos en un periodo determinado, la diferencia representa:','Tu patrimonio neto actualizado.','El ahorro generado en ese periodo.','Los impuestos que debes declarar.','Tu liquidez proyectada futura.','b','Intermedio'),
 /*43*/ makeQ('Antes de solicitar un crédito hipotecario es aconsejable:','Aumentar significativamente el cupo de tus tarjetas.','Solicitar un crédito tipo globo como respaldo.','Reducir o eliminar deudas de consumo existentes.','No revisar el estado de tus deudas actuales.','c','Intermedio'),
 /*44*/ makeQ('La diversificación de inversiones consiste en:','Invertir todos los recursos en una sola empresa sólida.','Guardar todo el dinero disponible en efectivo.','Comprar exclusivamente bonos gubernamentales.','Distribuir el capital en varios tipos de activos.','d','Intermedio'),
 /*45*/ makeQ('La educación financiera te permite principalmente:','Desarrollar habilidades para una salud financiera integral.','Calcular únicamente tasas de interés complejas.','Dejar de utilizar cuentas bancarias tradicionales.','Acumular efectivo sin establecer metas claras.','a','Intermedio'),
 /*46*/ makeQ('Al elegir fondos mutuos de inversión, el inversionista debe considerar:','La cantidad de oficinas que tiene la empresa.','Sus objetivos personales y tolerancia al riesgo.','Las opiniones no fundamentadas de amigos.','Los flujos históricos de capital extranjero.','b','Intermedio'),
 /*47*/ makeQ('Durante la vigencia de un crédito, el cliente tiene derecho a:','Exigir tasas menores sin procesos de negociación.','No ser evaluado crediticiamente en ningún momento.','Recibir comprobantes y documentación de movimientos.','Modificar unilateralmente las condiciones del contrato.','c','Intermedio'),
 /*48*/ makeQ('La práctica recomendada con facturas, recibos e impuestos pagados es:','Desecharlos inmediatamente después del pago.','Incluirlos en tu portafolio de inversiones.','Archivar únicamente los del año fiscal actual.','Guardarlos de manera ordenada y accesible.','d','Intermedio'),
 /*49*/ makeQ('La competencia para gestionar ingresos y egresos personales implica:','Controlar los flujos de dinero del día a día.','Evaluar únicamente inversiones empresariales complejas.','Gestionar exclusivamente el capital de trabajo corporativo.','Calcular solamente tasas de interés de largo plazo.','a','Intermedio'),
 /*50*/ makeQ('El documento esencial para comprender los costos de un fondo mutuo es:','Tu declaración de renta anual presentada.','El prospecto informativo del fondo.','Los extractos bancarios mensuales recientes.','El contrato de arrendamiento de vivienda.','b','Intermedio'),
 /*51*/ makeQ('Una ventaja clave de las instituciones financieras reguladas es:','Ofrecer rentabilidades siempre superiores al mercado.','Operar con niveles de riesgo muy elevados.','Brindar seguridad legal y supervisión estatal.','Obligar a contratar todos sus productos disponibles.','c','Intermedio'),
 /*52*/ makeQ('Al enviar dinero de un país a otro, un factor crítico a verificar es:','Las tasas de interés vigentes en ambos países.','La historia completa de la institución financiera.','La situación geopolítica actual internacional.','El tipo de cambio aplicado en la transacción.','d','Intermedio'),
 /*53*/ makeQ('Los corredores o brokers hipotecarios son profesionales que:','Comparan opciones de crédito para el comprador.','Actúan como prestamistas informales no regulados.','Se dedican exclusivamente a tasar viviendas.','Funcionan como notarios especializados en inmuebles.','a','Intermedio'),
 /*54*/ makeQ('Una inversión con mayor potencial de crecimiento a largo plazo generalmente es:','Cuentas de ahorro tradicionales básicas.','Fondos mutuos de renta variable (accionarios).','Certificados de depósito a término fijo.','Apuestas deportivas y juegos de azar.','b','Intermedio'),
 /*55*/ makeQ('Para iniciar un presupuesto personal efectivo debes primero:','Cancelar completamente todas tus deudas.','Establecer una fuente de ingreso pasivo.','Estimar tus ingresos y gastos del periodo.','Completar formularios de declaración de impuestos.','c','Intermedio'),
 /*56*/ makeQ('La diferencia principal entre proveedores formales e informales de remesas es que los formales:','No cobran ningún tipo de comisión por servicio.','Operan sin ninguna regulación gubernamental.','No reportan las transacciones a las autoridades.','Están supervisados por autoridades financieras.','d','Intermedio'),

/* 57..84 Avanzado */
 /*57*/ makeQ('La principal diferencia entre solvencia y liquidez es que:','La liquidez mide tu capacidad inmediata de pago.','La solvencia se aplica exclusivamente a empresas.','La liquidez calcula únicamente activos futuros.','Ambos términos son completamente idénticos.','a','Avanzado'),
 /*58*/ makeQ('Las metas financieras deben definirse antes del presupuesto porque:','Evitan el pago de impuestos innecesarios.','Orientan cómo se distribuirán los recursos.','Permiten calcular con precisión tu patrimonio neto.','Determinan automáticamente la tasa efectiva anual.','b','Avanzado'),
 /*59*/ makeQ('La sostenibilidad financiera a largo plazo implica:','Realizar un esfuerzo de ahorro único y puntual.','Invertir exclusivamente en negocios ecológicos.','Mantener disciplina constante para asegurar estabilidad.','Buscar retornos inmediatos y muy elevados.','c','Avanzado'),
 /*60*/ makeQ('Para alguien que ya tiene hábitos sólidos de ahorro, el análisis detallado de gastos:','Debe realizarse diariamente sin excepción.','Debe enfocarse exclusivamente en gastos de lujo.','Puede ser menos riguroso si ya hay control establecido.','Debe eliminar por completo los gastos fijos.','c','Avanzado'),
 /*61*/ makeQ('En el análisis presupuestario, la "diferencia real" se refiere a:','La diferencia entre ingresos y gastos reales.','La variación entre el plan y el ahorro logrado.','El saldo disponible en certificados de depósito.','La diferencia nominal reportada por el banco.','a','Avanzado'),
 /*62*/ makeQ('Refinanciar una deuda consiste en:','Extender el plazo sin revisar otras condiciones.','Reemplazar un préstamo por otro con mejores términos.','Consolidar automáticamente todas las deudas existentes.','Eliminar completamente los intereses acumulados.','b','Avanzado'),
 /*63*/ makeQ('Cuando un préstamo de tasa ajustable no cubre todos los intereses generados, ocurre:','Una situación de mora preventiva automática.','La aplicación de una tasa preferencial temporal.','Amortización negativa del capital.','Un periodo de pago extendido sin cargos.','c','Avanzado'),
 /*64*/ makeQ('El APR (Annual Percentage Rate) de un préstamo representa:','La tasa de interés simple del banco prestamista.','El porcentaje de tu patrimonio comprometido.','La tasa de inflación estimada para el periodo.','El costo anual total incluyendo intereses y cargos.','d','Avanzado'),
 /*65*/ makeQ('El principal riesgo al contratar un asesor financiero por horas es:','Contratar alguien ineficiente sin claridad del costo final.','Estar obligado a tasas de interés específicas.','Ser forzado a realizar inversiones inmediatas.','No poder modificar el plan financiero después.','a','Avanzado'),
 /*66*/ makeQ('Las tarjetas de crédito tienen tasas de interés elevadas principalmente porque:','No requieren garantías reales o colaterales.','Están subsidiadas por programas gubernamentales.','Son préstamos sin contrato formal escrito.','Se diseñan exclusivamente para uso empresarial.','a','Avanzado'),
 /*67*/ makeQ('La libertad financiera se alcanza cuando:','Tu consumo mensual supera tus ingresos regulares.','El rendimiento de tus activos cubre tus gastos.','Acumulas múltiples tarjetas de crédito disponibles.','El banco incrementa tus tasas de interés.','b','Avanzado'),
 /*68*/ makeQ('Los ahorros destinados a objetivos de corto plazo deben mantenerse en:','Acciones de empresas con alta volatilidad.','Inversiones en negocios emprendedores.','Instrumentos líquidos y de bajo riesgo.','Préstamos hipotecarios de largo plazo.','c','Avanzado'),
 /*69*/ makeQ('Un fondo de emergencia adecuado generalmente equivale a:','Un mes completo de salario neto recibido.','La mitad del valor total de tu patrimonio.','Un trimestre completo de ingresos brutos.','De 3 a 6 meses de gastos esenciales.','d','Avanzado'),
 /*70*/ makeQ('Comprar un bono como inversión significa:','Prestar dinero a un emisor que pagará intereses.','Adquirir acciones de propiedad en una empresa.','Comprar un certificado de depósito variable.','Adquirir un pagaré de obligación personal.','a','Avanzado'),
 /*71*/ makeQ('Un portafolio de inversión se define como:','Un crédito hipotecario estructurado y complejo.','Un conjunto diversificado de activos financieros.','Un certificado de depósito de largo plazo.','Una anualidad vitalicia garantizada.','b','Avanzado'),
 /*72*/ makeQ('En matemática financiera, la capitalización es el proceso de:','Convertir el valor futuro en valor inicial presente.','Sumar todas las cuotas pagadas históricamente.','Obtener el valor futuro desde el capital inicial.','Reducir las tasas de interés aplicables.','c','Avanzado'),
 /*73*/ makeQ('El valor nominal de un documento financiero es:','Su valor descontado a la fecha actual.','El capital inicial sin considerar intereses.','El valor presente con fines legales.','La cantidad a pagar al vencimiento.','d','Avanzado'),
 /*74*/ makeQ('La educación financiera busca principalmente:','Formar hábitos para decisiones sostenibles.','Convertirte en un experto bursátil profesional.','Incrementar continuamente tu nivel de gasto.','Enfocarse exclusivamente en el ahorro.','a','Avanzado'),
 /*75*/ makeQ('Tener previsión de contingencias significa:','Evitar solicitar cualquier préstamo hipotecario.','Poder afrontar imprevistos sin endeudarse.','Realizar retiros impulsivos frecuentemente.','Cubrir únicamente las deudas existentes.','b','Avanzado'),
 /*76*/ makeQ('Una desventaja para adultos que reciben educación financiera por primera vez es:','Aprender los conceptos demasiado rápido.','Obtener menores ingresos temporalmente.','Resistirse a cambiar hábitos arraigados.','No poder acceder a inversiones complejas.','c','Avanzado'),
 /*77*/ makeQ('Cuando la educación financiera se evalúa mediante pruebas estandarizadas, hablamos de:','Educación financiera conductual aplicada.','Análisis contextual de finanzas personales.','Medición parafiscal de conocimientos.','Educación financiera objetiva.','d','Avanzado'),
 /*78*/ makeQ('Para evitar compras impulsivas o emocionales se recomienda:','Usar estrategias de control consciente del dinero.','Endeudarse únicamente con "deuda buena".','Pagar todas las compras con préstamos.','Comprar siempre en épocas de promociones.','a','Avanzado'),
 /*79*/ makeQ('La riqueza medida en términos de tiempo se refiere a:','La cantidad de dinero que ganas anualmente.','Cuánto tiempo puedes vivir sin ingresos activos.','La suma total de tus inversiones actuales.','El valor acumulado en propiedades inmobiliarias.','b','Avanzado'),
 /*80*/ makeQ('Un seguro es fundamentalmente:','Un certificado de depósito con características especiales.','Una inversión de renta fija garantizada.','Un acuerdo de compensación por pérdidas mediante pagos.','Un crédito rotativo de emergencia.','c','Avanzado'),
 /*81*/ makeQ('Una tarjeta de pago (charge card) se caracteriza por:','Tener intereses rotativos mensuales variables.','No requerir ningún pago mínimo mensual.','Exigir pago total del saldo en cada corte.','Ser una tarjeta prepagada recargable.','c','Avanzado'),
 /*82*/ makeQ('Una tarjeta de débito se diferencia de una de crédito porque:','Toma dinero directamente de tu cuenta.','Utiliza un cupo de dinero prestado.','Permite pagos en cuotas extendidas.','Siempre genera intereses sobre saldo.','a','Avanzado'),
 /*83*/ makeQ('Un fondo de renta fija de corto plazo típicamente invierte en:','Bonos con vencimientos superiores a 10 años.','Bonos que maduran en 2-3 años aproximadamente.','Acciones con alta volatilidad de mercado.','Contratos de futuros en divisas internacionales.','b','Avanzado'),
 /*84*/ makeQ('Un Certificado de Inversión indexado es atractivo porque:','Está completamente libre de impuestos siempre.','Equivale a un préstamo sin garantías.','Sus rendimientos suelen ajustarse con la inflación.','Utiliza únicamente interés simple en su cálculo.','c','Avanzado')
];

/* ---------- Distribución Opción A (6 por equipo / 12 por llave) ---------- */
const poolP = questionsAll.slice(0,28);   // Principiante
const poolI = questionsAll.slice(28,56);  // Intermedio
const poolA = questionsAll.slice(56,84);  // Avanzado

// convert to queues (so we can remove used items)
function toQueue(arr){ return arr.slice(); }
let qP = toQueue(poolP), qI = toQueue(poolI), qA = toQueue(poolA);

function takeFrom(q,n){
  const out = q.splice(0,n);
  return out;
}

const quizzes = {
  q1:{ id:'q1', teams:['Los Cotiquinos','Financiados y Asociados'], topic:'Presupuestos', questions:[] },
  q2:{ id:'q2', teams:['Los Tarara','Money Squad'], topic:'Crédito', questions:[] },
  q3:{ id:'q3', teams:['CashCrew','Capitalizados'], topic:'Ahorro', questions:[] },
  q4:{ id:'q4', teams:['Capital Go Three','Dayro Moreno'], topic:'Inversión', questions:[] },
  sf1:{ id:'sf1', teams:['Ganador Q1','Ganador Q2'], topic:'Riesgo & Deuda', questions:[] },
  sf2:{ id:'sf2', teams:['Ganador Q3','Ganador Q4'], topic:'Seguros & Planificación', questions:[] },
  f:{ id:'f', teams:['Ganador SF1','Ganador SF2'], topic:'Planificación a Largo Plazo', questions:[] }
};

/* Fill quarters: per match team1:4P+2I ; team2:3P+3I */
for(const k of ['q1','q2','q3','q4']){
  const team1 = [...takeFrom(qP,4), ...takeFrom(qI,2)];
  const team2 = [...takeFrom(qP,3), ...takeFrom(qI,3)];
  quizzes[k].questions = [...team1, ...team2]; // 12 items
}

/* Semifinales */
quizzes.sf1.questions = [
  ...takeFrom(qA,5), // sf1 team1 5A
  ...takeFrom(qI,1), // +1I
  ...takeFrom(qA,3), // sf1 team2 3A
  ...takeFrom(qI,3)  // +3I
];

quizzes.sf2.questions = [
  ...takeFrom(qA,3), // sf2 team1 3A
  ...takeFrom(qI,3), // +3I
  ...takeFrom(qA,5), // sf2 team2 5A
  ...takeFrom(qI,1)  // +1I
];

/* Final: remaining 12 Avanzado */
quizzes.f.questions = [
  ...takeFrom(qA,6),
  ...takeFrom(qA,6)
];

/* Basic validation */
(function validate(){
  let total=0;
  for(const k in quizzes){
    if(quizzes[k].questions.length !== 12) console.warn('Llave',k,'tiene',quizzes[k].questions.length,'preguntas (esperadas 12)');
    total += quizzes[k].questions.length;
  }
  console.log('Total preguntas asignadas:', total); // should be 84
})();

/* ---------- Bracket state ---------- */
const bracketState = {
  q1:{winner:null, scoreA:0, scoreB:0},
  q2:{winner:null, scoreC:0, scoreD:0},
  q3:{winner:null, scoreE:0, scoreF:0},
  q4:{winner:null, scoreG:0, scoreH:0},
  sf1:{winner:null},
  sf2:{winner:null},
  f:{winner:null}
};

/* ---------- UI & Logic: alternation + timer + skip + feedback toast ---------- */
const modalBackdrop = document.getElementById('modalBackdrop');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalSubtitle = document.getElementById('modalSubtitle');
const quizContainer = document.getElementById('quizContainer');
const closeModal = document.getElementById('closeModal');
const timerDisplay = document.getElementById('timerDisplay');
const skipBtn = document.getElementById('skipBtn');
const nextBtn = document.getElementById('nextBtn');
const submitQuiz = document.getElementById('submitQuiz');
const progressText = document.getElementById('progressText');
const teamText = document.getElementById('teamText');
const numText = document.getElementById('numText');
const toastEl = document.getElementById('toast');

let currentMatchKey = null;
let currentQuiz = null;
let answers = []; // 12 entries: 'a'|'b'|'c'|'d'|null|'skipped'
let displayOrder = [];
let currentPointer = 0;
let timer = null;
const TIME_PER_Q = 30;
let timeLeft = TIME_PER_Q;

/* build alternated order for 12 */
function buildOrder12(){ const ord=[]; for(let i=0;i<6;i++){ ord.push(i); ord.push(i+6);} return ord; }

/* render current question */
function renderCurrent(){
  const idx = displayOrder[currentPointer];
  const q = currentQuiz.questions[idx];
  const isTeam1 = idx < 6;
  const team = isTeam1 ? currentQuiz.teams[0] : currentQuiz.teams[1];
  const qNumForTeam = isTeam1 ? (idx+1) : (idx-5);
  quizContainer.innerHTML = '';
  const box = document.createElement('div'); box.className='qbox';
  box.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
    <div><strong>Pregunta ${currentPointer+1}/12 — Equipo: ${team}</strong></div>
    <div class="small muted">Nivel: ${q.level}</div>
  </div>
  <div style="margin-top:8px">${q.text}</div>`;
  const opts = document.createElement('div'); opts.className='options';
  ['a','b','c','d'].forEach(letter=>{
    const label = document.createElement('label'); label.className='option';
    label.innerHTML = `<input type="radio" name="answer" value="${letter}"> <span><strong>${letter}.</strong> ${q.options[letter]}</span>`;
    // when user selects, immediately evaluate
    label.querySelector('input').addEventListener('change', (e)=>{
      evaluateAnswer(idx, e.target.value);
    });
    opts.appendChild(label);
  });
  box.appendChild(opts);
  quizContainer.appendChild(box);

  progressText.textContent = `Pregunta ${currentPointer+1}/12`;
  teamText.textContent = `Equipo: ${team}`;
  numText.textContent = `N° para equipo: ${qNumForTeam}`;

  // next/submit visibility handled; but with auto-advance we don't need next button except for manual flow
  nextBtn.style.display = 'none';
  submitQuiz.style.display = 'none';

  // start timer
  resetTimer();
  startTimer();
}

/* Timer functions */
function startTimer(){
  timeLeft = TIME_PER_Q; timerDisplay.textContent = `${timeLeft}s`;
  timer = setInterval(()=>{
    timeLeft--; timerDisplay.textContent = `${timeLeft}s`;
    if(timeLeft <= 0){
      clearInterval(timer);
      handleTimeout();
    }
  },1000);
}
function resetTimer(){ if(timer) clearInterval(timer); timeLeft = TIME_PER_Q; timerDisplay.textContent = `${timeLeft}s`; }

/* Evaluate answer selected */
function evaluateAnswer(qIndex, choice){
  // stop timer
  if(timer) clearInterval(timer);
  // store answer
  answers[qIndex] = choice;
  const q = currentQuiz.questions[qIndex];
  const correct = q.correct;
  const isCorrect = (choice === correct);
  // show toast with correct answer info
  if(isCorrect){
    showToast(`✔ Correcto — La respuesta era: ${correct.toUpperCase()}`, 'correct');
  } else {
    showToast(`✘ Incorrecto — La respuesta correcta era: ${correct.toUpperCase()}`, 'wrong');
  }
  // after toast duration, advance pointer
  setTimeout(()=>{
    advanceAfterFeedback();
  },1500);
}

/* Handle timeout (auto-skip) */
function handleTimeout(){
  const idx = displayOrder[currentPointer];
  answers[idx] = 'skipped';
  const q = currentQuiz.questions[idx];
  showToast(`⏭ Tiempo agotado — Respuesta: ${q.correct.toUpperCase()}`, 'skip');
  setTimeout(()=>{ advanceAfterFeedback(); },1500);
}

/* Manual skip */
skipBtn.addEventListener('click', ()=>{
  if(confirm('¿Saltar esta pregunta? (Se perderán los puntos)')){
    if(timer) clearInterval(timer);
    const idx = displayOrder[currentPointer];
    answers[idx] = 'skipped';
    const q = currentQuiz.questions[idx];
    showToast(`⏭ Pregunta saltada — Respuesta: ${q.correct.toUpperCase()}`, 'skip');
    setTimeout(()=>{ advanceAfterFeedback(); },1500);
  }
});

/* Advance to next question or show submit */
function advanceAfterFeedback(){
  if(currentPointer < 11){
    currentPointer++;
    renderCurrent();
  } else {
    // end -> show submit button
    quizContainer.innerHTML = '<div class="small muted">Has terminado las preguntas. Pulsa "Calcular ganador".</div>';
    submitQuiz.style.display = 'inline-block';
    timerDisplay.textContent = '—';
  }
}

/* Toast display (position: just below question) */
function showToast(message, type){
  toastEl.textContent = message;
  toastEl.className = 'toast show';
  if(type === 'correct'){ toastEl.style.background = 'linear-gradient(90deg, rgba(46,180,101,0.95), rgba(32,160,95,0.95))'; }
  else if(type === 'wrong'){ toastEl.style.background = 'linear-gradient(90deg, rgba(219,68,55,0.95), rgba(185,40,40,0.95))'; }
  else { toastEl.style.background = 'linear-gradient(90deg, rgba(95,99,110,0.95), rgba(75,80,90,0.95))'; }
  // ensure it's visible for 1.5s, then hide via class
  setTimeout(()=>{ toastEl.className = 'toast'; }, 1500);
}

/* Submit quiz: calculate weighted scores, decide winner */
submitQuiz.addEventListener('click', ()=>{
  if(timer) clearInterval(timer);
  let score1 = 0, score2 = 0;
  for(let i=0;i<12;i++){
    const q = currentQuiz.questions[i];
    const ans = answers[i];
    if(ans && ans === q.correct){
      const w = WEIGHTS[q.level] || 1;
      if(i < 6) score1 += w; else score2 += w;
    }
  }
  // determine winner
  let winner = null;
  if(score1 > score2) winner = currentQuiz.teams[0];
  else if(score2 > score1) winner = currentQuiz.teams[1];
  else {
    if(confirm('Empate. ¿Desempatar aleatoriamente? OK = aleatorio, Cancel = elegir manualmente')){
      winner = Math.random() < 0.5 ? currentQuiz.teams[0] : currentQuiz.teams[1];
    } else {
      const pick = prompt(`Empate. Escribe 1 para ${currentQuiz.teams[0]} o 2 para ${currentQuiz.teams[1]}`);
      if(pick==='1') winner = currentQuiz.teams[0];
      else if(pick==='2') winner = currentQuiz.teams[1];
      else { alert('Entrada inválida. Se aplicará desempate aleatorio.'); winner = Math.random()<0.5 ? currentQuiz.teams[0] : currentQuiz.teams[1]; }
    }
  }

  applyResultToBracket(currentMatchKey, score1, score2, winner);
  modalBackdrop.style.display = 'none';
});

/* Open quiz (single click for quarters, dblclick for semis/final) */
document.querySelectorAll('.match').forEach(el=>{
  const key = el.getAttribute('data-match');
  if(!key) return;
  if(key.startsWith('q')) el.addEventListener('click', ()=>openQuiz(key));
  else el.addEventListener('dblclick', ()=>openQuiz(key));
});

/* openQuiz implementation */
function openQuiz(key){
  currentMatchKey = key;
  currentQuiz = quizzes[key];
  if(!currentQuiz){ alert('Esa llave no tiene quiz asignado'); return; }
  modalTitle.textContent = `Llave: ${key.toUpperCase()} — ${currentQuiz.teams[0]} vs ${currentQuiz.teams[1]}`;
  modalSubtitle.textContent = `Tema: ${currentQuiz.topic} — 12 preguntas (6 por equipo) - Alternadas`;
  answers = new Array(12).fill(null);
  displayOrder = buildOrder12();
  currentPointer = 0;
  renderCurrent();
  modalBackdrop.style.display = 'flex';
}

/* Close modal */
closeModal.addEventListener('click', ()=>{ modalBackdrop.style.display = 'none'; if(timer) clearInterval(timer); });
modalBackdrop.addEventListener('click', (e)=>{ if(e.target === modalBackdrop){ modalBackdrop.style.display='none'; if(timer) clearInterval(timer); } });

/* applyResultToBracket updates UI and propagates winners */
function applyResultToBracket(matchKey, s1, s2, winnerLabel){
  if(matchKey==='q1'){
    document.getElementById('score-q1-A').textContent = s1;
    document.getElementById('score-q1-B').textContent = s2;
    bracketState.q1.scoreA = s1; bracketState.q1.scoreB = s2; bracketState.q1.winner = winnerLabel;
  } else if(matchKey==='q2'){
    document.getElementById('score-q2-C').textContent = s1;
    document.getElementById('score-q2-D').textContent = s2;
    bracketState.q2.scoreC = s1; bracketState.q2.scoreD = s2; bracketState.q2.winner = winnerLabel;
  } else if(matchKey==='q3'){
    document.getElementById('score-q3-E').textContent = s1;
    document.getElementById('score-q3-F').textContent = s2;
    bracketState.q3.scoreE = s1; bracketState.q3.scoreF = s2; bracketState.q3.winner = winnerLabel;
  } else if(matchKey==='q4'){
    document.getElementById('score-q4-G').textContent = s1;
    document.getElementById('score-q4-H').textContent = s2;
    bracketState.q4.scoreG = s1; bracketState.q4.scoreH = s2; bracketState.q4.winner = winnerLabel;
  } else if(matchKey==='sf1'){
    document.getElementById('score-sf1-1').textContent = s1;
    document.getElementById('score-sf1-2').textContent = s2;
    bracketState.sf1.winner = winnerLabel;
    document.getElementById('f-team1').querySelector('.team-name').textContent = winnerLabel;
    document.getElementById('score-f-1').textContent = '—';
  } else if(matchKey==='sf2'){
    document.getElementById('score-sf2-1').textContent = s1;
    document.getElementById('score-sf2-2').textContent = s2;
    bracketState.sf2.winner = winnerLabel;
    document.getElementById('f-team2').querySelector('.team-name').textContent = winnerLabel;
    document.getElementById('score-f-2').textContent = '—';
  } else if(matchKey==='f'){
    document.getElementById('score-f-1').textContent = s1;
    document.getElementById('score-f-2').textContent = s2;
    bracketState.f.winner = winnerLabel;
    setTimeout(()=>alert(`¡Campeón del torneo: ${winnerLabel}!`),200);
  }

  markWinnerInMatchUI(matchKey, winnerLabel);
  propagateQuarterToSemi();
}

/* Propagate quarter winners */
function propagateQuarterToSemi(){
  if(bracketState.q1.winner) document.getElementById('sf1-team1').querySelector('.team-name').textContent = bracketState.q1.winner;
  if(bracketState.q2.winner) document.getElementById('sf1-team2').querySelector('.team-name').textContent = bracketState.q2.winner;
  if(bracketState.q3.winner) document.getElementById('sf2-team1').querySelector('.team-name').textContent = bracketState.q3.winner;
  if(bracketState.q4.winner) document.getElementById('sf2-team2').querySelector('.team-name').textContent = bracketState.q4.winner;
}

/* Visual winner marker */
function markWinnerInMatchUI(matchKey, winner){
  const matchEl = document.querySelector(`[data-match="${matchKey}"]`);
  if(matchEl){
    matchEl.querySelectorAll('.team-row').forEach(r=>r.classList.remove('winner'));
    matchEl.querySelectorAll('.team-row').forEach(r=>{
      const nm = r.querySelector('.team-name').textContent.trim();
      if(nm === winner) r.classList.add('winner');
    });
  }
  document.querySelectorAll('.final-box').forEach(box=>{
    box.querySelectorAll('.team-row').forEach(r=>r.classList.remove('winner'));
    box.querySelectorAll('.team-row').forEach(r=>{
      const nm = r.querySelector('.team-name').textContent.trim();
      if(nm === winner) r.classList.add('winner');
    });
  });
}

/* Reset */
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(!confirm('¿Seguro que deseas resetear todo el bracket?')) return;
  for(const k in bracketState) bracketState[k] = { winner:null };
  document.getElementById('score-q1-A').textContent='—'; document.getElementById('score-q1-B').textContent='—';
  document.getElementById('score-q2-C').textContent='—'; document.getElementById('score-q2-D').textContent='—';
  document.getElementById('score-q3-E').textContent='—'; document.getElementById('score-q3-F').textContent='—';
  document.getElementById('score-q4-G').textContent='—'; document.getElementById('score-q4-H').textContent='—';
  document.getElementById('sf1-team1').querySelector('.team-name').textContent='—';
  document.getElementById('sf1-team2').querySelector('.team-name').textContent='—';
  document.getElementById('sf2-team1').querySelector('.team-name').textContent='—';
  document.getElementById('sf2-team2').querySelector('.team-name').textContent='—';
  document.getElementById('f-team1').querySelector('.team-name').textContent='—';
  document.getElementById('f-team2').querySelector('.team-name').textContent='—';
  document.querySelectorAll('.team-row').forEach(r=>r.classList.remove('winner'));
  document.getElementById('score-sf1-1').textContent='—'; document.getElementById('score-sf1-2').textContent='—';
  document.getElementById('score-sf2-1').textContent='—'; document.getElementById('score-sf2-2').textContent='—';
  document.getElementById('score-f-1').textContent='—'; document.getElementById('score-f-2').textContent='—';
});

/* Debug */
console.log('Quizzes cargados:', Object.keys(quizzes).length);
</script>
</body>
</html>
